<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <title>XMLHttpRequest</title>
</head>
<body>
  <h1>XMLHttpRequest</h1>

  <p>üìç Para refor√ßar:</p>

  <p>Abordamos em m√≥dulos anteriores APIs e como elas funcionavam, uma das formas de consumirmos as informa√ß√µes dela no front-end √© usando uma API nativa do JavaScript chamada XMLHttpRequest. Apesar do nome XMLHttpRequest, os dados podem ser recebidos do servidor atrav√©s de JSON, XML, HTML, ou como texto puro al√©m disso ela pode ser usado para recuperar qualquer tipo de dado e fornece suporte aos protocolos HTTP, FILE e FTP.</p>

  <p>A XMLHttpRequest tem um papel importante na t√©cnica de desenvolvimento web Ajax, atrav√©s dela conseguimos enviar requisi√ß√µes para determinadas URLs e obter suas respostas sem que as p√°ginas sejam recarregadas, em outras palavras, quando o usu√°rio clicar em um bot√£o, a busca do mesmo ser√° efetuada e as informa√ß√µes ser√£o preenchidas para usu√°rio sem que a p√°gina recarregue.</p>

  <h2>Requisi√ß√µes com XMLHttpRequest</h2>

  <p>Para facilitar o entendimento, vamos criar um pequeno formul√°rio que conseguimos fazer a busca do endere√ßo utilizando o CEP. Para isso vamos utilizar a API <a href="https://viacep.com.br">https://viacep.com.br</a> .</p>

  <p>Vamos ent√£o criar uma inst√¢ncia do objeto para come√ßarmos a utiliz√°-lo:</p>

  <pre>
    <code>
      let xhr = new XMLHttpRequest();
    </code>
  </pre>

  <p>Com o objeto criado, vamos utilizar o m√©todo open para come√ßarmos a criar a nossa requisi√ß√£o:</p>

  <pre>
    <code>
      xhr.open('GET', url, true);
    </code>
  </pre>

  <p>O m√©todo open recebe tr√™s par√¢metros, sendo eles:</p>

  <ol>
    <li>O verbo HTTP (conhecido tamb√©m como os tipos GET, POST, PUT e etc) a ser utilizado para realizar a requisi√ß√£o, o mesmo deve seguir o padr√£o REST.</li>
    <li>A URL que pretendemos obter os dados.</li>
    <li>Um argumento booleano informando se a requisi√ß√£o deve ser ass√≠ncrona ou s√≠ncrona.</li>
  </ol>

  <p>Agora precisamos implementar a propriedade onreadystatechange que √© disparada sempre que nossa requisi√ß√£o sofre alguma altera√ß√£o durante seu processamento:</p>

  <pre>
    <code>
      xhr.onreadystatechange = function() {
      }
    </code>
  </pre>

  <p>Repare que passamos uma fun√ß√£o de callback, ou seja, uma fun√ß√£o que sempre ser√° executada assim que a requisi√ß√£o sofrer alguma altera√ß√£o. Quando implementamos essa fun√ß√£o precisamos tomar alguns cuidados, o primeiro √© verificar se a mesma foi finalizada, mas como fazer essa verifica√ß√£o? Fazemos isso atrav√©s do <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState">xhr.readyState</a>:</p>

  <pre>
    <code>
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
        //requisi√ß√£o finalizada
        }
      }
    </code>
  </pre>

  <p>O c√≥digo 4 nos informa que a requisi√ß√£o foi finalizada, por√©m ainda n√£o √© suficiente, afinal, finalizada n√£o significa que foi bem sucedida, portanto, √© necess√°rio verificar se ela foi realizada com sucesso tamb√©m! Para isso, faremos uso do <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status">xhr.status</a>:</p>

  <pre>
    <code>
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
        // faz alguma coisa
        }
      }
    </code>
  </pre>

  <p>O c√≥digo 200 nos informa que a requisi√ß√£o obteve sucesso durante seu processamento. Isso significa que agora podemos acessar a resposta que o servidor nos enviou e realizar alguma fun√ß√£o desejada.</p>

  <p>O primeiro passo ser√° pegar a refer√™ncia do campo CEP para obtermos seu valor:</p>

  <pre>
    <code>
      let inputCep = document.getElementById('cep');
      let cep = inputCep.value;
    </code>
  </pre>

  <p>Feito isso j√° podemos come√ßar construir nossa URL:</p>

  <pre>
    <code>
      let url = 'https://viacep.com.br/ws/' + cep + '/json';
    </code>
  </pre>

  <p>Com nossa URL pronta, podemos come√ßar a implementar o XMLHttpRequest conforme visto anteriormente:</p>

  <pre>
    <code>
      let xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
    
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          console.log(xhr.responseText);
        }
      }
      xhr.send();
    </code>
  </pre>
  
  <p>Voc√™ pode ver esse exemplo completo funcionando em: https://newtab-academy.github.io/XMLHttpRequest-CEP/</p>

  <p>Link citado no v√≠deo: https://www.w3schools.com/js/js_ajax_http.asp</p>
</body>
</html>